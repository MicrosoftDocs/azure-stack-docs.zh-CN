---
title: 在 Azure 和 Azure Stack 上构建时的混合应用程序设计注意事项
description: 为智能云和智能边缘构建混合应用程序时的注意事项。
author: BryanLa
ms.topic: article
ms.date: 11/05/2019
ms.author: bryanla
ms.reviewer: anajod
ms.lastreviewed: 11/05/2019
ms.openlocfilehash: adc185b290d0006ed3a32584a7e3d8473ba2aa6c
ms.sourcegitcommit: 4ac711ec37c6653c71b126d09c1f93ec4215a489
ms.translationtype: MT
ms.contentlocale: zh-CN
ms.lasthandoff: 02/27/2020
ms.locfileid: "77689913"
---
# <a name="hybrid-application-design-considerations"></a>混合应用程序设计注意事项 

Microsoft Azure 是唯一一致的混合云。 它可让你重复使用开发投资，并使可跨全球 Azure、主权 Azure 云和 Azure Stack 的应用程序成为你的数据中心内的 Azure 扩展。 跨云的应用程序也称为*混合应用程序*。

[*Azure 应用程序体系结构指南*](https://docs.microsoft.com/azure/architecture/guide)介绍了一种结构化的方法，可用于设计可缩放、复原和高度可用的应用程序。 [*Azure 应用程序体系结构指南*](https://docs.microsoft.com/azure/architecture/guide)中所述的注意事项同样适用于为单一云设计的应用程序，以及适用于跨云的应用程序。

本文介绍了[*Azure 应用程序*](https://docs.microsoft.com/azure/architecture/guide/) [*体系结构指南*](https://docs.microsoft.com/azure/architecture/guide/)中所述[*软件质量的支柱*](https://docs.microsoft.com/azure/architecture/guide/pillars)，重点介绍如何设计混合应用程序。 此外，我们添加了一个*放置*支柱，因为混合应用程序并不是一个云和一个本地数据中心。

混合方案与可用于开发的资源差别很大，并且跨越各种注意事项，如地域、安全性、Internet 访问和其他注意事项。 尽管本指南无法枚举特定的注意事项，但它可以提供一些关键指导原则和最佳实践。 成功设计、配置、部署和维护混合应用程序体系结构涉及许多设计注意事项，这些注意事项可能并不是您所熟知的。

本文档旨在聚合实施混合应用程序时可能出现的问题，并提供有关如何使用它们的注意事项（这些支柱）和最佳实践。 通过在设计阶段解决这些问题，可以避免在生产中导致的问题。

实质上，这些是在创建混合应用程序之前需要考虑的问题。 若要开始，你需要执行以下操作：

-   确定和评估应用程序组件。

-   根据支柱评估应用程序组件。

## <a name="evaluate-the-application-components"></a>评估应用程序组件

应用程序的每个组件在较大的应用程序中都有其自己的特定角色，应查看所有设计注意事项。 每个组件的要求和功能应映射到这些注意事项，以帮助确定应用程序的体系结构。

通过研究应用程序的体系结构并确定其构成的内容，将应用程序分解到其组件中。 组件还可以包括应用程序与之交互的其他应用程序。 在识别组件时，请根据其特性评估预期的混合操作，例如：

-   组件的用途是什么？

-   组件之间的相互依赖关系是什么？

例如，应用程序可以将前端和后端定义为两个组件。 在混合方案中，前端位于一个云中，后端位于另一个云中。 应用程序

提供前端与用户之间以及前端与后端之间的通信通道。

应用程序组件由多种形式和方案定义。 最重要的任务是标识它们及其云或本地位置。

表1中列出了要包含在清单中的常见应用程序组件。

### <a name="table-1-common-app-components"></a>表 1. 常见应用程序组件


| 组件 | **混合应用程序指南** |
| ---- | ---- |
| 客户端连接 | 你的应用程序（在任何设备上）可以通过多种方式从单一入口点访问用户，其中包括：<br>-客户端-服务器模型，要求用户安装客户端以使用应用程序。 从 web 浏览器访问的基于服务器的应用程序。<br>-客户端连接可以在连接断开时包含通知，或在可能应用漫游费用时发出警报。 |
| Authentication  | 连接到应用程序的用户或连接到另一组件的一个组件都需要进行身份验证。 |
| API  | 您可以使用 API 集和类库向开发人员提供对应用程序的编程访问，并提供基于 Internet 标准的连接接口。 你还可以使用 Api 将应用程序分解为独立的操作逻辑单元。 |
| 服务  | 您可以使用简洁的服务来提供应用程序的功能。 服务可以是运行应用程序的引擎。 |
| 队列 | 你可以使用队列来组织应用程序组件的生命周期和状态的状态。 这些队列可为订阅方提供消息传送、通知和缓冲功能。 |
| 数据存储 | 应用程序可以是无状态的，也可以是有状态的。 有状态应用程序需要可由多种格式和卷满足的数据存储。 |
| 数据缓存  | 设计中的数据缓存组件可战略性地解决延迟问题，并在触发云爆发方面扮演角色。 |
| 数据引入 | 可以通过多种方式将数据提交到应用程序，从 web 窗体中的用户提交的值到连续的高容量数据流。 |
| 数据处理 | 您可以在源中处理数据处理任务（例如报表、分析、批处理导出和数据转换），也可以使用数据副本在单独的组件上将其卸载。 |

## <a name="assess-app-components-for-pillars"></a>评估用于支柱的应用组件

对于每个组件，请为每个支柱评估其特性。 当你用所有的支柱来评估每个组件时，你可能未考虑的问题可能会影响混合应用程序的设计。 根据这些考虑，可以增加优化应用程序的价值。 表2提供了每个支柱的描述，因为它与混合应用程序相关。

### <a name="table-2-pillars"></a>表 2. 支柱

| **支柱** | **说明** |
| ----------- | --------------------------------------------------------- |
| 位置  | 混合应用程序中组件的战略定位。 |
| 可伸缩性  | 系统处理增加的负载的能力。 |
| 可用性  | 混合应用程序正常运行和工作的时间比例。 |
| 复原 | 混合应用程序恢复的能力。 |
| 可管理性 | 让系统在生产环境中持续运行的操作过程。 |
| 安全性 | 保护混合应用程序和数据免受威胁。 |

## <a name="placement"></a>位置

混合应用程序本质上有放置考虑因素，例如数据中心的。

放置是定位组件的重要任务，使其能够更好地为混合应用程序服务。 按照定义，混合应用程序将跨位置，例如从本地到云，以及在不同云中。 可以通过两种方式将应用程序的组件放置在云上：

-   **垂直混合应用程序**  
    应用程序组件分布在不同的位置。 每个单独的组件只能有多个实例位于同一位置。

-   **横向混合应用程序**  
    应用程序组件分布在不同的位置。 每个单个组件可以有多个跨多个位置的实例。
    
    某些组件可以知道其位置，而其他组件则不知道其位置和位置。 可使用抽象层实现此 virtuousness。 此层具有新式应用程序框架（如微服务），可以定义应用程序的服务方式，因为它是在跨云的节点上操作的应用程序组件的位置。

### <a name="placement-checklist"></a>放置清单

**验证所需的位置。** 请确保应用程序或其任何组件在运行或需要特定云的认证时需要。 这可能包括公司的主权要求或法律规定的要求。 此外，确定特定位置或区域设置是否需要任何本地操作。

**确定连接依赖关系。** 必需的位置和其他因素可以规定组件之间的连接依赖关系。 放置组件时，确定它们之间的通信的最佳连接和安全性。 选项包括[ *VPN*、](https://docs.microsoft.com/azure/vpn-gateway/) [ *ExpressRoute*](https://docs.microsoft.com/azure/expressroute/)和[*混合连接*。](https://docs.microsoft.com/azure/app-service/app-service-hybrid-connections)

**评估平台功能。** 对于每个应用程序组件，请查看应用程序组件所需的资源提供程序在云中是否可用，以及带宽能否满足预期的吞吐量和延迟要求。

**规划可移植性。** 使用新式应用程序框架（如容器或微服务）来规划移动操作并防止服务依赖项。

**确定数据主权要求。** 混合应用程序适用于容纳数据隔离，如本地数据中心。 查看资源的位置，以优化是否可满足此要求。

**规划滞后时间。** 云间操作可在应用程序组件之间引入物理距离。 确定要求以适应任何滞后时间。

**控制流量流。** 当前端在公有云中进行访问时，处理个人身份信息数据的高峰使用情况以及合适和安全的通信。

## <a name="scalability"></a>可伸缩性

可伸缩性是指系统能够处理应用程序上增加的负载的能力，随着其他因素和因素的增加，它们会影响受众大小，还会影响应用程序的大小和范围。

有关此支柱的核心讨论，请参阅软件质量的支柱中的[*可伸缩性*](https://docs.microsoft.com/azure/architecture/guide/pillars#scalability)。

混合应用程序的水平缩放方法允许添加更多实例以满足需求，然后在更短时间内将其禁用。

在混合方案中，当组件分散到云时，横向扩展单个组件需要额外的注意事项。 缩放应用程序的一个部分可能需要对另一个部分进行缩放。 例如，如果客户端连接数增加，但应用程序的 web 服务未适当扩展，则数据库上的负载可能会使应用程序变满。

某些应用程序组件可以线性横向扩展，而其他组件则有缩放依赖项，并且可能会限制在扩展的范围。 例如，为应用程序组件位置提供混合连接的 VPN 隧道对带宽和延迟的限制都有限制。 如何缩放应用程序的组件以确保满足这些要求？

### <a name="scalability-checklist"></a>可伸缩性清单

**确定缩放阈值。** 若要处理应用程序中的各种依赖关系，请确定不同云中的应用程序组件可以彼此独立地扩展的程度，同时仍满足运行该应用程序的要求。 混合应用程序通常需要缩放应用程序中的特定区域，以便在它交互时处理某个功能并影响应用程序的其余部分。 例如，超过多个前端实例可能需要缩放后端。

**定义刻度计划。** 大多数应用程序都有繁忙的期限，因此需要将高峰时间聚合为计划以协调最佳缩放。

**使用集中式监视系统。** 平台监视功能可提供自动缩放功能，但混合应用程序需要一个集中式监视系统，用于聚合系统运行状况和负载。 集中式监视系统可以启动在一个位置缩放资源，并根据另一个位置的资源缩放。 此外，中央监视系统可以跟踪哪些云自动缩放资源，哪些云不自动缩放资源。

**利用自动缩放功能（如有）。** 如果自动缩放功能是您的体系结构的一部分，则可以通过设置阈值来实现自动缩放，该阈值用于定义应用程序组件需要向上扩展、向下、向下或在中的时间。 自动缩放的一个示例是在一个云中自动缩放的客户端连接，以处理增加的容量，但会导致应用程序的其他依赖项分散在不同的云之间，同时进行缩放。 这些从属组件的自动缩放功能必须已确定。

如果自动缩放不可用，请考虑实施脚本和其他资源，以适应手动缩放，由集中式监视系统中的阈值触发。

**按位置确定预期负载。** 处理客户端请求的混合应用程序可能主要依赖于单个位置。 当客户端请求负载超过阈值时，

可以在不同的位置添加其他资源来分发入站请求的负载。 请确保客户端连接可以处理增加的负载，同时确定用于处理负载的客户端连接的任何自动化过程。

## <a name="availability"></a>可用性

可用性是指系统正常运行和工作的时间。 可用性按运行时间的百分比进行度量。 应用程序错误、基础结构问题和系统负载都会降低可用性。

有关此支柱的核心讨论，请参阅软件质量的支柱中的[*可用性*](/azure/architecture/framework/)。

### <a name="availability-checklist"></a>可用性核对清单

**提供连接的冗余。** 混合应用程序需要在应用程序所跨的云之间建立连接。 你可以选择用于混合连接的技术，因此除了你的主要技术选择以外，还可以使用其他技术通过自动故障转移功能来提供冗余，以便在主要技术发生故障时使用。

**对容错域进行分类。** 容错应用程序需要多个容错域。 容错域可帮助确定故障点，例如，如果单个硬盘在本地失败，则在机箱顶部交换机出现故障时，或者如果完整的数据中心不可用，则为。 在混合应用程序中，位置可以归类为容错域。 如果有更多的可用性要求，则需要评估单个容错域的分类方式。

**对升级域进行分类。** 升级域用于确保应用程序组件的实例可用，而相同组件的其他实例则由更新或功能升级服务。 与容错域一样，升级域可以按照它们在不同位置的放置进行分类。 必须确定应用程序组件是否可以在升级到另一个位置之前升级到一个位置，或者是否需要其他域配置。 单个位置本身可以有多个升级域。

**跟踪实例和可用性。** 高度可用的应用程序组件可通过负载平衡和同步数据复制来使用。 您必须确定在服务中断之前可以脱机的实例数。

**实现自我修复。** 如果某个问题导致应用程序可用性中断，则监视系统的检测可能会启动对应用程序的自我修复活动，例如，排出发生故障的实例并进行重新部署。 这很可能需要使用集中式监视解决方案，并与混合持续集成和持续交付（CI/CD）管道集成。 应用程序与监视系统集成，以确定可能需要重新部署应用程序组件的问题。 监视系统还可以触发混合 CI/CD，以便在相同或其他位置重新部署应用程序组件和其他任何依赖组件。

**维护服务级别协议（Sla）。** 可用性对于维护与客户的服务和应用程序的连接至关重要。 混合应用程序所依赖的每个位置可能有其自己的 SLA。 这些不同的 Sla 可能会影响混合应用程序的总体 SLA。

## <a name="resiliency"></a>复原

复原功能使混合应用程序和系统能够从故障中恢复并继续工作。 复原能力的目标是在故障发生后将应用程序恢复到可完全正常运行的状态。 复原策略包括备份、复制和灾难恢复等解决方案。

有关此支柱的核心讨论，请参阅软件质量的支柱中的[*复原*](https://docs.microsoft.com/azure/architecture/guide/pillars#resiliency)功能。

### <a name="resiliency-checklist"></a>复原能力查检表

**发现灾难恢复依赖关系。** 一个云中的灾难恢复可能需要更改另一云中的应用程序组件。 如果一个云中的一个或多个组件故障转移到另一个位置（在同一云或其他云中），则需要了解这些更改。 这还包括连接依赖关系。 复原需要为每个云提供完全测试的应用程序恢复计划。

**建立恢复流。** 有效的恢复流设计已评估应用程序组件，使其能够容纳缓冲区、重试、重试失败的数据传输，并在必要时回退到不同的服务或工作流。 您必须确定要使用的备份机制、其还原过程涉及的内容以及测试的频率。 还应确定增量备份和完整备份的频率。

**测试部分恢复。** 部分应用程序的部分恢复可以为所有不可用的用户提供确信。 计划的此部分应确保部分还原不会有任何副作用，如备份和还原服务，该服务与应用程序交互，以便在进行备份之前正常关闭。

**确定灾难恢复 instigators 并分配责任。** 除了可以备份和还原哪些角色外，恢复计划还应说明哪些用户以及哪些角色可以启动备份和恢复操作。

**将自愈阈值与灾难恢复进行比较。** 确定应用程序的自动恢复启动功能，以及将应用程序自愈视为失败或成功所需的时间。 确定每个云的阈值。

**验证复原功能的可用性。** 确定每个位置的复原特性和功能的可用性。 如果某个位置未提供所需的功能，请考虑将该位置集成到提供复原功能的集中式服务。

**确定停机时间。** 确定作为整体和应用程序组件的应用程序维护所需的停机时间。

**记录故障排除过程。** 定义用于重新部署资源和应用程序组件的故障排除过程。

## <a name="manageability"></a>可管理性

如何管理混合应用程序的注意事项对设计体系结构至关重要。 管理良好的混合应用程序提供了一种基础结构作为代码，使你能够在常见开发管道中集成一致的应用程序代码。 通过实现对基础结构的更改进行一致的系统范围和单独测试，你可以确保在更改通过测试时集成部署，使其能够合并到源代码中。

有关此支柱的核心讨论，请参阅软件质量的支柱中的[*DevOps*](/azure/architecture/framework/#devops) 。

### <a name="manageability-checklist"></a>可管理性清单

**实现监视。** 使用跨云分布的应用程序组件的集中式监视系统提供其运行状况和性能的聚合视图。 此系统包括监视应用程序组件和相关的平台功能。

确定应用程序中需要监视的部分。

**坐标策略。** 混合应用程序跨越的每个位置都可以有自己的策略，涵盖允许的资源类型、命名约定、标记和其他条件。

**定义和使用角色。** 作为数据库管理员，您需要确定需要访问应用程序资源的不同角色（如应用程序所有者、数据库管理员和最终用户）所需的权限。 需要在资源上和应用程序中配置这些权限。 基于角色的访问控制（RBAC）系统允许您对应用程序资源设置这些权限。 如果将所有资源部署在一个云中，但在将资源分散到云时需要更多关注，则这些访问权限会很有挑战性。 在一个云中对资源设置的权限不适用于其他云中的资源集。

**使用 CI/CD 管道。** 持续集成和持续开发（CI/CD）管道可为创作和部署跨云的应用程序提供一致的过程，并为其基础结构和应用程序提供质量保证。 此管道使基础结构和应用程序能够在一个云中进行测试并部署在另一个云上。 管道甚至允许你将混合应用程序的某些组件部署到一个云，将其他组件部署到另一个云，本质上形成了混合应用程序部署的基础。 CI/CD 系统对于处理应用程序组件在安装过程中相互之间的依赖性至关重要，如需要将连接字符串连接到数据库的 web 应用程序。

**管理生命周期。** 由于混合应用程序的资源可以跨位置，因此，每个单一位置的生命周期管理功能都需要聚合到单个生命周期管理单元中。 考虑如何创建、更新和删除它们。

**检查故障排除策略。** 对混合应用程序进行故障排除涉及比在单个云中运行的应用程序组件更多的应用程序组件。 除了云之间的连接，应用程序在两个平台上运行，而不是在两个平台上运行。 对混合应用程序进行故障排除的一项重要任务是检查应用程序组件的聚合运行状况和性能监视。

## <a name="security"></a>安全性

安全性是任何云应用程序的主要注意事项之一，对于混合云应用程序，它会变得更加重要。

有关此支柱的核心讨论，请参阅软件质量的支柱中的[*安全性*](https://docs.microsoft.com/azure/architecture/guide/pillars#security)。

### <a name="security-checklist"></a>安全清单

**假定被破坏。** 如果应用程序的一个部分受到损害，请确保存在解决方案，以最大程度地减少泄露的传播，而不仅在同一位置，还在不同位置。

**监视允许的网络访问。** 确定应用程序的网络访问策略，例如仅从特定子网访问应用程序，并且仅允许应用程序正常运行所需的组件之间的最小端口和协议。

**使用可靠的身份验证。** 可靠的身份验证方案对应用程序的安全性至关重要。 请考虑使用提供单一登录功能的联合身份提供程序，并使用以下一个或多个方案：用户名和密码登录、公钥和私钥、双因素身份验证或多重身份验证以及受信任的安全组合. 确定用于存储敏感数据的适当资源以及用于应用程序身份验证的其他机密以及证书类型及其要求。

**使用加密。** 确定应用程序的哪些区域使用加密，如用于数据存储或客户端通信和访问。

**使用安全通道。** 跨云的安全通道对于跨云提供安全和身份验证检查、实时保护、隔离和其他服务至关重要。

**定义和使用角色。** 跨云实现资源配置和单标识访问的角色。 确定应用程序及其平台资源的基于角色的访问控制（RBAC）要求。

**审核您的系统。** 系统监视可以从应用程序组件和相关的云平台操作记录并聚合数据。

## <a name="summary"></a>总结

本文提供了在创作和设计混合应用程序的过程中要考虑的项的清单。 在部署应用程序之前查看这些要点可防止在生产中断时遇到这些问题，并可能需要重新访问设计。

这似乎是一项非常耗时的任务，但如果基于这些支柱设计应用程序，则可以轻松获得投资回报。

## <a name="next-steps"></a>后续步骤

有关详细信息，请参阅以下资源：

-   [混合云](https://azure.microsoft.com/overview/hybrid-cloud/)
-   [混合云应用程序](https://azure.microsoft.com/solutions/hybrid-cloud-app/)
-   [开发用于实现云一致性的 Azure 资源管理器模板](https://aka.ms/consistency)