---
title: Azure 和 Azure Stack 集线器中的混合应用设计注意事项
description: 了解为智能云和智能边缘构建混合应用时的设计注意事项，包括放置、可伸缩性、可用性和复原能力。
author: BryanLa
ms.topic: article
ms.date: 11/05/2019
ms.author: bryanla
ms.reviewer: anajod
ms.lastreviewed: 11/05/2019
ms.openlocfilehash: 8f37967534452c43788cbe0c40490ee4021ca5f0
ms.sourcegitcommit: a630894e5a38666c24e7be350f4691ffce81ab81
ms.translationtype: MT
ms.contentlocale: zh-CN
ms.lasthandoff: 04/16/2020
ms.locfileid: "80812323"
---
# <a name="hybrid-app-design-considerations"></a>混合应用设计注意事项

Microsoft Azure 是唯一一致的混合云。 它可让你重复使用开发投资，并使可跨全球 Azure、主权 Azure 云和 Azure Stack 的应用程序成为你的数据中心内的 Azure 扩展。 跨云的应用也称为*混合应用*。

[*Azure 应用程序体系结构指南*](https://docs.microsoft.com/azure/architecture/guide)介绍了一种结构化的方法，可用于设计可缩放、复原和高度可用的应用。 [*Azure 应用程序体系结构指南*](https://docs.microsoft.com/azure/architecture/guide)中所述的注意事项同样适用于适用于单个云和适用于云的应用的应用。

本文介绍了[*Azure 应用程序*](https://docs.microsoft.com/azure/architecture/guide/) [*体系结构指南*](https://docs.microsoft.com/azure/architecture/guide/)中所述[*软件质量的支柱*](https://docs.microsoft.com/azure/architecture/guide/pillars)，重点介绍如何设计混合应用。 此外，我们添加了一个*放置*支柱，因为混合应用不是一个云或一个本地数据中心。

混合方案与可用于开发的资源差别很大，并且跨越各种注意事项，如地域、安全性、internet 访问和其他注意事项。 尽管本指南无法枚举特定的注意事项，但它可以提供一些关键指导原则和最佳实践。 成功设计、配置、部署和维护混合应用程序体系结构涉及许多设计注意事项，这些注意事项可能并不是您所熟知的。

本文档旨在聚合在实施混合应用时可能会出现的问题，并提供相关注意事项（这些支柱）和最佳实践。 通过在设计阶段解决这些问题，可以避免在生产中导致的问题。

实质上，这些是在创建混合应用之前需要考虑的问题。 若要开始，你需要执行以下操作：

- 确定和评估应用程序组件。
- 根据支柱评估应用组件。

## <a name="evaluate-the-app-components"></a>评估应用程序组件

应用程序的每个组件在较大的应用程序中都有其自己的特定角色，应查看所有设计注意事项。 每个组件的要求和功能应映射到这些注意事项，以帮助确定应用程序体系结构。

通过研究您的应用程序的体系结构并确定其构成的内容，将您的应用程序分解到其组件中。 组件还可以包含应用与之交互的其他应用。 当你识别组件时，请通过提出以下问题来根据其特征评估你的预期混合操作：

- 组件的用途是什么？
- 组件之间的相互依赖关系是什么？

例如，应用可以有一个前端和后端定义为两个组件。 在混合方案中，前端位于一个云中，后端位于另一个云中。 此应用提供前端和用户之间的通信通道，还提供前端与后端之间的通信通道。

应用组件由多种形式和方案定义。 最重要的任务是识别组件及其云位置或本地位置。

表1列出了要包含在清单中的常见应用程序组件。

### <a name="table-1-common-app-components"></a>表 1. 常见的应用组件

| 组件  | **混合应用指南** |
| ---- | ---- |
| 客户端连接 | 你的应用（在任何设备上）可以通过多种方式从单一入口点访问用户，包括以下方法：<br>-客户端-服务器模型，要求用户安装客户端以使用应用。 从浏览器访问的基于服务器的应用程序。<br>- 客户端连接可以包括连接中断时发出的通知，或发生漫游费时发出的警报。 |
| 身份验证  | 连接到应用程序的用户或连接到另一组件的一个组件都需要进行身份验证。 |
| API  | 可以通过 API 集和类库向开发人员提供对应用程序的编程访问，并提供基于 internet 标准的连接接口。 你还可以使用 Api 将应用分解为独立的操作逻辑单元。 |
| 服务  | 您可以使用简洁的服务来提供应用程序的功能。 服务可以是运行应用的引擎。 |
| 队列 | 你可以使用队列来组织应用组件的生命周期和状态的状态。 这些队列可为订阅方提供消息传送、通知和缓冲功能。 |
| 数据存储 | 应用可以是无状态的，也可以是有状态的。 有状态应用需要可由多种格式和卷满足的数据存储。 |
| 数据缓存  | 设计中的数据缓存组件可按策略解决延迟问题，并在触发云负载喷发方面发挥作用。 |
| 数据引入 | 可以通过多种方式将数据提交到应用，从 web 窗体中的用户提交值到连续的高容量数据流。 |
| 数据处理 | 可在源中执行数据处理任务（例如报告、分析、批量导出和数据转换），或使用数据副本在独立的组件上减轻这些任务的负载。 |

## <a name="assess-app-components-for-pillars"></a>评估应用组件的要素

对于每个组件，需评估其每个要素的特征。 当你用所有的支柱来评估每个组件时，你可能未考虑的问题可能会影响混合应用的设计。 根据这些注意事项，可以增加优化应用的价值。 表2提供了每个支柱的描述，因为它与混合应用相关。

### <a name="table-2-pillars"></a>表 2. 要素

| **构成要素** | **描述** |
| ----------- | --------------------------------------------------------- |
| 位置  | 混合应用程序中组件的战略定位。 |
| 可伸缩性  | 系统处理增加的负载的能力。 |
| 可用性  | 混合应用正常运行和工作的时间比例。 |
| 复原 | 混合应用程序的恢复能力。 |
| 可管理性 | 让系统在生产环境中持续运行的操作过程。 |
| 安全性 | 保护混合应用和数据免受威胁。 |

## <a name="placement"></a>位置

混合应用本质上是针对数据中心的放置注意事项。

放置是定位组件的重要任务，使其能够更好地为混合应用服务。 按照定义，混合应用跨位置，如从本地到云以及在不同云中。 可以通过两种方式将应用程序的组件放置在云上：

- **垂直混合应用**  
    应用组件分布在不同的位置。 每个组件可以有多个仅位于一个位置的实例。

- **横向混合应用**  
    应用组件分布在不同的位置。 每个组件可以有多个跨多个位置的实例。

    某些组件可以知道其位置，而其他组件则不知道其位置和位置。 这种识别力可通过一个抽象层来实现。 此层使用现代应用程序框架（如微服务），可以通过在云的节点上操作的应用程序组件的位置来定义应用程序的服务方式。

### <a name="placement-checklist"></a>定位查检表

**验证所需的位置。** 请确保应用程序或其任何组件在运行或需要特定云的认证时需要。 这可能包括公司或法律规定的主权要求。 此外，确定特定的位置或区域设置是否需要任何本地操作。

**确定连接依赖关系。** 所需的位置和其他因素可以指示组件之间的连接依赖关系。 定位组件时，请确定它们之间的通信的最佳连接和安全性。 选项包括[ *VPN*、](https://docs.microsoft.com/azure/vpn-gateway/) [ *ExpressRoute*](https://docs.microsoft.com/azure/expressroute/)和[*混合连接*。](https://docs.microsoft.com/azure/app-service/app-service-hybrid-connections)

**评估平台功能。** 对于每个应用程序组件，请查看应用程序组件所需的资源提供程序在云中是否可用，以及带宽能否满足预期的吞吐量和延迟要求。

**规划可移植性。** 使用新式应用框架（如容器或微服务）来计划移动操作并防止服务依赖项。

**确定数据主权要求。** 混合应用适用于容纳数据隔离，如本地数据中心。 请检查资源的定位方式，以进行优化并成功应对此项要求。

**规划延迟。** 云间操作可在应用程序组件之间引入物理距离。 请确定有关应对任何延迟的要求。

**控制流量流。** 在公有云中的前端访问个人身份信息数据时，请控制高峰用量，并确保该数据的传输方式适当且安全。

## <a name="scalability"></a>可伸缩性

可伸缩性是指系统能够处理应用上增加的负载的能力，随着应用程序的大小和范围的增加，其他因素和影响受众的规模会随时间而变化。

有关此支柱的核心讨论，请参阅体系结构卓越的五个要素中的[*可伸缩性*](https://docs.microsoft.com/azure/architecture/guide/pillars#scalability)。

混合应用的水平缩放方法允许添加更多实例以满足需求，然后在更短时间内将其禁用。

在混合方案中，当组件分散到不同的云时，扩展单个组件需要考虑到其他因素。 缩放应用程序的一个部分可能需要进行另一个应用程序的缩放。 例如，如果客户端连接数增加，但应用的 web 服务未适当扩展，则数据库上的负载可能会使应用变满。

某些应用程序组件可以线性横向扩展，而有些则会扩展依赖项，并且可能会限制在扩展的范围内。 例如，为应用程序组件位置提供混合连接的 VPN 隧道对带宽和延迟的限制都有限制。 如何缩放应用程序的组件以确保满足这些要求？

### <a name="scalability-checklist"></a>可伸缩性清单

**确定缩放阈值。** 若要处理应用中的各种依赖关系，请确定不同云中的应用程序组件可以彼此独立地扩展的程度，同时满足运行该应用程序的要求。 混合应用程序通常需要缩放应用程序中的特定区域，以便在它交互时处理功能并影响应用程序的其余部分。 例如，超过多个前端实例可能需要缩放后端。

**定义缩放计划。** 大多数应用程序都有繁忙的期限，因此需要将其高峰时间聚合为计划以协调最佳缩放。

**使用集中式监视系统。** 平台监视功能可提供自动缩放，但混合应用需要集中式监视系统来聚合系统运行状况和负载。 集中式监视系统可以启动在一个位置缩放资源，并根据其他位置的资源进行缩放。 此外，中央监视系统可以跟踪哪些云自动缩放资源，哪些云不自动缩放资源。

**利用自动缩放功能（如果适用）。** 如果自动缩放功能是您的体系结构的一部分，则可以通过设置阈值来实现自动缩放，该阈值定义应用程序组件需要向上、向下、向下或向下缩放的时间。 自动缩放的一个示例是在一个云中自动缩放的客户端连接，用来处理增加的容量，但会导致应用程序的其他依赖关系分散到不同的云，同时进行缩放。 必须确定这些依赖组件是否有自动缩放功能。

如果无法使用自动缩放，请考虑实施脚本和其他资源，以适应手动缩放，并由集中式监视系统中的阈值触发。

**按位置确定预期负载。** 处理客户端请求的混合应用可能主要依赖于单个位置。 当客户端请求的负载超过阈值时，可以在不同的位置添加其他资源来分发入站请求的负载。 确保客户端连接可以处理增加的负载，并确定是否有任何自动化过程可供客户端连接处理负载。

## <a name="availability"></a>可用性

可用性是指系统正常运行的时间。 可用性以正常运行时间百分比来计量。 应用错误、基础结构问题和系统负载均可降低可用性。

有关此支柱的核心讨论，请参阅体系结构卓越的五个要素中的[*可用性*](/azure/architecture/framework/)。

### <a name="availability-checklist"></a>可用性核对清单

**为连接提供冗余。** 混合应用需要在应用所跨的云之间建立连接。 可为混合连接选择所需的技术，因此，除了选择的主要技术外，还可以使用另一项技术来提供冗余能力，以便在主要技术发生故障时进行自动化故障转移。

**对容错域进行分类。** 容错应用程序需要多个容错域。 容错域有助于找到故障点，例如，是本地的单个硬盘故障、架顶式交换机故障，还是整个数据中心不可用。 在混合应用中，可以将位置分类为容错域。 可用性要求越高，就越需要评估单个容错域的分类方式。

**对升级域进行分类。** 升级域用于确保应用程序组件的实例可用，而相同组件的其他实例则由更新或功能升级服务。 与容错域一样，升级域也可按其定位位置来分类。 必须确定应用组件是否可以在升级到另一个位置之前升级到一个位置，或者是否需要其他域配置。 单个位置本身可以包含多个升级域。

**跟踪实例和可用性。** 高度可用的应用组件可通过负载平衡和同步数据复制来使用。 必须确定在服务中断之前最多可以有多少个实例脱机。

**实施自我修复。** 如果某个问题导致应用可用性中断，则监视系统的检测可能会启动对应用的自我修复活动，例如，排出发生故障的实例并进行重新部署。 这很有可能需要一个中心监视解决方案，并与混合持续集成和持续交付 (CI/CD) 管道相集成。 应用与监视系统集成，以确定可能需要重新部署应用组件的问题。 监视系统还可以触发混合 CI/CD，以便在相同或其他位置重新部署应用组件和其他任何依赖组件。

**维护服务级别协议 (SLA)。** 可用性对于维护与客户的服务和应用的连接至关重要。 混合应用依赖的每个位置可能有自己的 SLA。 这些不同的 Sla 可能会影响混合应用的总体 SLA。

## <a name="resiliency"></a>复原

复原功能使混合应用和系统能够从故障中恢复并继续工作。 复原的目标是在故障发生后将应用程序恢复到完全正常运行的状态。 恢复策略包括备份、复制和灾难恢复等解决方案。

有关此支柱的核心讨论，请参阅体系结构卓越的五个要素中的[*复原能力*](https://docs.microsoft.com/azure/architecture/guide/pillars#resiliency)。

### <a name="resiliency-checklist"></a>复原能力查检表

**发现灾难恢复依赖项。** 一个云中的灾难恢复可能需要更改另一云中的应用组件。 如果一个云中的一个或多个组件故障转移到另一个位置（在同一云或其他云中），则需要了解这些更改。 这还包括连接依赖项。 复原需要为每个云提供完全测试的应用恢复计划。

**建立恢复流。** 有效的恢复流设计已评估应用程序组件，使其能够容纳缓冲区、重试、重试失败的数据传输，并在必要时回退到不同的服务或工作流。 您必须确定要使用的备份机制、其还原过程涉及的内容以及测试的频率。 还应确定增量和完整备份的频率。

**测试部分恢复。** 应用程序的部分恢复可以向不能使用的用户提供确信。 计划的此部分应该确保部分还原不会有任何副作用，如备份和还原服务，该服务与应用程序交互，以便在进行备份之前正常关闭。

**确定灾难恢复调查人员并分配职责。** 恢复计划应在可备份和还原的项目以外，连带说明哪些人员和哪些角色可以启动备份和恢复操作。

**比较自我修复阈值与灾难恢复。** 确定应用的自动恢复启动的自愈功能，以及将应用程序自愈视为失败或成功所需的时间。 确定每个云的阈值。

**验证复原功能的可用性。** 对每个位置确定复原功能的可用性。 如果某个位置未提供所需的功能，请考虑将该位置集成到提供复原功能的集中式服务。

**确定停机时间。** 确定作为整体和应用组件的应用维护所需的停机时间。

**制定故障排除过程的文档。** 定义用于重新部署资源和应用组件的故障排除过程。

## <a name="manageability"></a>可管理性

管理混合应用的相关注意事项对设计体系结构至关重要。 管理良好的混合应用程序提供了一种基础结构作为代码，使你能够在常见开发管道中集成一致的应用代码。 通过实现对基础结构的更改进行一致的系统范围和单独测试，你可以确保在更改通过测试时集成部署，使其能够合并到源代码中。

有关此支柱的核心讨论，请参阅体系结构卓越的五个要素中的[*DevOps*](/azure/architecture/framework/#devops) 。

### <a name="manageability-checklist"></a>可管理性查检表

**实施监视。** 使用应用组件的集中式监视系统跨云分布，提供其运行状况和性能的聚合视图。 此系统包括监视应用组件和相关的平台功能。

确定应用程序中需要监视的部分。

**协调策略。** 混合应用跨越的每个位置都可以有自己的策略，涵盖允许的资源类型、命名约定、标记和其他条件。

**定义和使用角色。** 作为数据库管理员，您需要确定需要访问应用资源的不同角色（如应用所有者、数据库管理员和最终用户）所需的权限。 需要在资源上和应用程序中配置这些权限。 基于角色的访问控制（RBAC）系统允许对应用资源设置这些权限。 将所有资源部署在单个云中时，这些访问权限将难以处理；当资源分散在不同的云中时，更需要加以慎重。 在一个云中对资源设置的权限不适用于其他云中的资源集。

**使用 CI/CD 管道。** 持续集成和持续开发（CI/CD）管道可为创作和部署跨云的应用提供一致的过程，并为其基础结构和应用提供质量保证。 此管道使基础结构和应用可在一个云中进行测试，并在另一个云上部署。 管道甚至允许你将混合应用程序的某些组件部署到一个云，将其他组件部署到另一个云，本质上形成了混合应用程序部署的基础。 CI/CD 系统是在安装过程中处理依赖项应用程序组件的关键，如需要将连接字符串连接到数据库的 web 应用。

**管理生命周期。** 由于混合应用的资源可跨位置，因此，每个单一位置的生命周期管理功能都需要聚合到单个生命周期管理单元中。 考虑如何创建、更新和删除它们。

**检查故障排除策略。** 混合应用程序疑难解答比在单个云中运行的应用程序组件更多。 除了云之间的连接，应用程序在两个平台上运行，而不是在两个平台上运行。 对混合应用进行故障排除的一项重要任务是检查应用组件的聚合运行状况和性能监视。

## <a name="security"></a>安全性

安全性是任何云应用程序的主要注意事项之一，它对于混合云应用更重要。

有关此支柱的核心讨论，请参阅体系结构卓越的五个要素中的[*安全性*](https://docs.microsoft.com/azure/architecture/guide/pillars#security)。

### <a name="security-checklist"></a>安全清单

**假想安全漏洞。** 如果应用程序的一个部分受到损害，请确保存在解决方案，以最大程度地减少泄露的传播，而不仅在同一位置，还在不同位置。

**监视允许的网络访问。** 确定应用的网络访问策略，例如仅从特定子网访问应用，并且仅允许应用程序正常运行所需的组件之间的最小端口和协议。

**使用可靠的身份验证。** 可靠的身份验证方案对应用程序的安全性至关重要。 考虑使用可提供单一登录功能的联合标识提供者，并采用以下一种或多种方案：用户名和密码登录、公钥和私钥、双重或多重身份验证，以及受信任的安全组。 确定用于存储敏感数据的适当资源和应用身份验证的其他机密以及证书类型及其要求。

**使用加密。** 确定应用使用加密的区域，如用于数据存储或客户端通信和访问。

**使用安全通道。** 云间必须存在安全通道才能提供安全性和身份验证检查、实时保护、隔离和其他跨云服务。

**定义和使用角色。** 对跨云的资源配置和单一标识访问实施角色。 确定应用及其平台资源的基于角色的访问控制（RBAC）要求。

**审核系统。** 系统监视可以从应用组件和相关的云平台操作记录和聚合数据。

## <a name="summary"></a>摘要

本文提供在创作和设计混合应用过程中需要考虑的事项的清单。 在部署应用之前查看这些支柱可防止在生产中断中遇到这些问题，并可能需要重新访问设计。

这似乎是一项非常耗时的任务，但如果基于这些支柱设计应用程序，则可以轻松获得投资回报。

## <a name="next-steps"></a>后续步骤

有关更多信息，请参见以下资源：

- [混合云](https://azure.microsoft.com/overview/hybrid-cloud/)
- [混合云应用](https://azure.microsoft.com/solutions/hybrid-cloud-app/)
- [开发 Azure 资源管理器模板以实现云一致性](https://aka.ms/consistency)