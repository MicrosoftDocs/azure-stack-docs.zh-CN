---
title: 适用于 Azure Stack 的混合云设计模式 |Microsoft Docs
description: 用于混合云和智能边缘，并且将 Azure Stack 的模式的概述
services: azure-stack
documentationcenter: ''
author: mattbriggs
manager: femila
editor: ''
ms.service: azure-stack
ms.workload: na
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: tutorial
ms.date: 07/17/2019
ms.author: mabrigg
ms.reviewer: anajod
ms.lastreviewed: 06/11/2019
ms.openlocfilehash: 339f0dda56f8f0974e9bf9cd2e0cb8cac1668f0a
ms.sourcegitcommit: 2a4cb9a21a6e0583aa8ade330dd849304df6ccb5
ms.translationtype: MT
ms.contentlocale: zh-CN
ms.lasthandoff: 07/17/2019
ms.locfileid: "68286880"
---
# <a name="hybrid-cloud-design-patterns-for-azure-stack"></a>适用于 Azure Stack 的混合云设计模式

Microsoft Azure 是唯一的一致混合云。 它，可以重复使用你的开发投资并使应用程序可以跨全球 Azure、 sovereign Azure 云中使用和 Azure Stack 中，这是你的数据中心中的 Azure 扩展。 跨云的应用程序也称为*混合应用程序*。

[ *Azure 应用程序体系结构指南*](https://docs.microsoft.com/azure/architecture/guide)介绍设计可缩放、 可复原且高度可用的应用程序的结构化的方法。 中所述的注意事项[ *Azure 应用程序体系结构指南*](https://docs.microsoft.com/azure/architecture/guide)同样适用于单个云以及跨云的应用程序设计的应用程序。

此文扩充[*软件质量的构成要素*](https://docs.microsoft.com/azure/architecture/guide/pillars)中所述[ *Azure 应用程序*](https://docs.microsoft.com/azure/architecture/guide/) [ *体系结构指南*，](https://docs.microsoft.com/azure/architecture/guide/)专注于设计的混合应用程序。 此外，我们将添加*放置*主要因为混合应用程序不是专用于一个云或其中一个本地数据中心。

混合方案因可用于开发的资源而有很大的不同，并且涉及地理、安全性、Internet 访问等考虑因素。 尽管本指南不能枚举您特定的考虑事项，但它可以提供一些重要原则和需遵循的最佳实践。 已成功设计、 配置、 部署和维护的混合应用程序体系结构涉及到许多不可能给你本质上是已知的设计注意事项。

本文档旨在聚合时实现的混合应用程序可能出现的问题，并提供的注意事项 （这些支柱） 和处理它们的最佳做法。 通过在设计阶段解决这些问题，您要防止它们可能导致在生产环境中的问题。

从根本上来说，这些是你需要创建混合应用程序之前要考虑的问题。 若要开始，你需要执行以下操作：

-   发现并评估应用程序组件。

-   评估针对支柱的应用程序组件。

## <a name="evaluate-the-application-components"></a>评估应用程序组件

应用程序的每个组件的大型应用程序中其自己特定角色，并且应查看与所有设计注意事项。 每个组件的要求和功能应映射到这些注意事项，以帮助确定应用程序体系结构。

通过学习应用程序的体系结构并确定它的包含分解为其组件的应用程序。 组件还可以包含其他应用程序与你的应用程序进行交互。 标识组件，如评估您的预期的混合操作根据它们的特征，如下所示：

-   组件的用途是什么？

-   在组件之间的相互依赖项有哪些？

例如，应用程序可以具有的前端和后端定义为两个组件。 在混合方案中，在一个云中为前端和后端是在另。 应用程序

提供了前端和后端之间以及在前端和用户之间的通信通道。

应用程序组件定义许多窗体和方案。 最重要的任务确定其和他们的云或本地位置。

表 1 中列出了要包含在清单中的常见应用程序组件。

### <a name="table-1-common-app-components"></a>表 1. 常见的应用程序组件


| 组件  | **混合应用程序指南** |
| ---- | ---- |
| 客户端连接 | （任何设备上） 的应用程序可以访问各种方法中的用户从单一入口点，其中包括：<br>的要求用户必须拥有才能使用该应用程序的客户端客户端-服务器模型。 基于服务器的应用程序，从 web 浏览器访问。<br>漫游费用可能应用时，客户端连接可以包括时连接已断开的通知或警报。 |
| 身份验证  | 连接到应用程序，或从连接到另一个组件的用户可以需要身份验证。 |
| API  | 可以为开发人员以编程方式访问提供到应用程序的 API 集和类库，并提供基于 Internet 标准的连接接口。 Api 还可用于分解应用程序分成独立操作的逻辑单元。 |
| Services  | 您可以使用简洁的服务来为应用程序中提供的功能。 一个服务可以在运行应用程序的引擎。 |
| 队列 | 可以使用队列来组织生命周期和应用程序的组件状态的状态。 消息传送的通知，和缓冲到订阅参与方的功能，可以提供这些队列。 |
| 数据存储 | 应用程序可以是无状态或有状态。 有状态应用程序需要可以满足的大量格式和卷的数据存储。 |
| 数据缓存  | 在设计中的数据缓存组件可以有策略地进行解决延迟问题，并在触发云爆发发挥作用。 |
| 数据引入 | 数据可以提交到应用程序在许多方面，范围从 web 窗体中用户提交值到持续大量数据流。 |
| 数据处理 | 在数据处理任务 （如报告、 分析、 批处理导出和数据转换） 可以在源中处理或卸载上一个单独的组件使用的数据副本。 |

## <a name="assess-app-components-for-pillars"></a>评估支柱的应用程序组件

对于每个组件，计算结果对于每个支柱及其特征。 在您评估每个支柱的所有组件，则不应该考虑的问题可能会成为你知道影响的混合应用程序设计的。 这些注意事项对可以在优化你的应用程序中添加值。 表 2 提供了每个支柱的说明，因为它与混合应用程序。

### <a name="table-2-pillars"></a>表 2。 要点

| **支柱** | **说明** |
| ----------- | --------------------------------------------------------- |
| 放置  | 混合应用程序中的组件的战略位置。 |
| 可伸缩性  | 系统处理增加的负载的能力。 |
| 可用性  | 混合应用程序且操作正常工作的时间比例。 |
| 复原 | 若要恢复的混合应用程序的功能。 |
| 可管理性 | 让系统在生产环境中持续运行的操作过程。 |
| 安全性 | 保护混合应用程序和数据免受威胁。 |

## <a name="placement"></a>放置

混合应用程序本质上是对放置的考虑因素，如在数据中心。

放置是重要的任务，以便它们可以提供最佳服务混合应用程序定位组件。 根据定义，混合应用程序跨位置，如从本地到云以及在不同的云。 可以将应用程序的组件放在两种方法中的云上：

-   **垂直混合应用程序**  
    应用程序组件分布在区域中。 每个组件可以有多个实例仅位于一个位置。

-   **水平混合应用程序**  
    应用程序组件分布在区域中。 每个组件可以跨越多个位置的多个实例。
    
    某些组件可以知道其位置，而其他人不具备其位置和放置的任何知识。 可以使用一个抽象层来实现此 virtuousness。 此层使用微服务之类的现代应用程序框架可以定义如何将应用程序服务的跨云节点上运行的应用程序组件的位置。

### <a name="placement-checklist"></a>放置清单

**验证所需的位置。** 请确保应用程序或其任意组件所需操作中，或为特定的云需要证书。 这可以包括从你的公司的主权要求或法律规定。 此外，确定是否需要针对某个特定位置或区域设置的本地的任何操作。

**确定连接依存关系。** 所需的位置和其他因素可以决定您的组件之间的连接依赖关系。 在放置组件，确定获得最佳的连接并在它们之间的通信安全。 选项包括[ *VPN*，](https://docs.microsoft.com/azure/vpn-gateway/) [ *ExpressRoute*，](https://docs.microsoft.com/azure/expressroute/)并[*混合连接*。](https://docs.microsoft.com/azure/app-service/app-service-hybrid-connections)

**平台功能的计算结果。** 有关每个应用程序组件，请参阅如果在云上可用的应用程序组件的所需的资源提供程序和带宽可容纳的预期的吞吐量和延迟要求。

**规划可移植性。** 使用现代应用程序框架，如容器或微服务，以规划移动操作并防止服务依赖项。

**确定满足数据主权需求。** 混合应用程序适合适应数据隔离，例如在本地数据中心。 查看你的资源以优化为适应此要求成功的位置。

**计划的延迟。** 间云操作可能会引入应用程序组件之间的物理距离。 确定要求，以适应任何延迟。

**控制流量。** 处理高峰使用情况和个人身份信息数据在公有云中前端进行访问时适当的安全通信。

## <a name="scalability"></a>可伸缩性

可伸缩性是系统能够处理的应用程序，可以强制其他因素，以及随时间而改变，影响除了大小和应用程序的作用域受众大小增加的负载。

有关此支柱核心讨论，请参阅[*可伸缩性*](https://docs.microsoft.com/azure/architecture/guide/pillars#scalability)软件质量的构成要素中。

水平扩展方法的混合应用程序可添加更多实例以满足需求，然后在低谷期期间禁用它们。

在混合方案中，向外扩展单个组件需要额外考虑，组件可分布在云中时。 缩放应用程序的一个部分可以要求的另一个缩放。 例如，如果增加的数量客户端连接的增加，但应用程序的 web 服务是不适当地将负载上数据库可能会使饱和应用程序。

某些应用程序组件可以向外扩展而呈线性增长，而其他人具有缩放依赖项，并可能会受到限制到什么扩展不能进行缩放。 例如，对于应用程序组件位置提供混合连接的 VPN 隧道对带宽和延迟它可以扩展到了限制。 如何缩放，以确保这些要求的应用程序组件是满足？

### <a name="scalability-checklist"></a>可伸缩性清单

**确定缩放阈值。** 若要处理你的应用程序中的各种依赖项，确定哪些应用程序中不同的云的组件可以缩放彼此，仍能满足要求运行该应用程序的范围。 混合应用程序通常需要缩放应用程序来处理一项功能，因为它进行交互，并会影响应用程序的其余部分中的特定区域。 例如，前端实例的数量超过可能需要缩放后端。

**定义缩放计划。** 大多数应用程序具有繁忙的时期，所以需要进行计划来协调最佳缩放到聚合其峰值时间。

**使用集中式监视系统。** 平台监视功能可以提供自动缩放，但混合应用程序需要聚合系统运行状况和负载的集中式监视系统。 集中式监视系统可以启动扩展一个位置中的资源和扩展具体情况取决于在另一个位置中的资源。 此外，该云自动缩放资源以及哪些云不可以跟踪中央监视系统。

**利用自动缩放功能 （如可用）。** 如果自动缩放功能是您的体系结构的一部分，您可以通过设置阈值来定义应用程序组件需要进行扩展、 扩展、 向下或中实现自动缩放。 自动缩放的示例是在一个云以处理更大的容量，自动缩放，但会导致其他依赖项的应用程序，分布在不同的云，还可按比例的客户端连接。 必须已确定这些相关组件的自动缩放功能。

未提供自动缩放时，请考虑实现脚本和其他资源，以适应手动缩放，在集中式监视系统触发的阈值。

**确定预期的负载的位置。** 处理客户端请求的混合应用程序可能主要依赖于单个位置。 当客户端请求的负载超过阈值，

可以在不同位置，以将入站请求负载添加更多资源。 请确保客户端连接可以处理增加的负载，并且还确定客户端连接来处理负载的任何自动化的过程。

## <a name="availability"></a>可用性

可用性是一个系统且操作正常工作的时间。 可用性按正常运行时间的百分比度量。 应用程序错误、基础结构问题和系统负载都会降低可用性。

有关此支柱核心讨论，请参阅[*可用性*](https://docs.microsoft.com/azure/architecture/guide/pillars#availability)软件质量的构成要素中。

### <a name="availability-checklist"></a>可用性核对清单

**为连接提供冗余。** 混合应用程序需要在应用程序分布在云之间的连接。 您可以选择适用于混合连接的技术，因此此外与您的主要技术选择，使用另一种技术来提供冗余，具有自动故障转移功能的主要技术会失败。

**对容错域进行分类。** 容错的应用程序需要多个容错域。 容错域帮助隔离点故障，例如，如果单个硬盘在本地，如果机架顶部交换机出现故障，或者是将失败的完整的数据中心不可用。 在混合应用程序中，一个位置可以归类为容错域。 与可用性要求的详细信息，越需要评估应如何分类单个容错域。

**对升级域进行分类。** 升级域用于确保应用程序组件的实例可用，同一组件的其他实例将与更新或功能的升级提供服务时。 容错域与升级域可进行分类的位置将其通过跨位置。 您必须确定如果应用程序组件可以容纳在另一个位置中，升级前升级在一个位置或其他域配置是必需的。 单个位置本身可以有多个升级域。

**跟踪实例和可用性。** 高度可用的应用程序组件可以是可通过负载平衡和同步数据复制。 您必须确定多少个实例可处于脱机状态之前服务中断。

**实现自我修复。** 以防出现问题导致应用程序可用性中断，通过监视系统检测可以启动自愈活动应用程序，如排出失败的实例和重新部署它。 最有可能，这需要的集中式的监视解决方案，与混合持续集成和持续交付 (CI/CD) 管道集成。 应用程序与一个监控系统来识别问题，可能需要重新部署应用程序组件的集成。 监视系统还可以触发混合 CI/CD 以重新部署应用程序组件，可能所有其他依赖组件在相同或其他位置。

**维护服务级别协议 (Sla)。** 可用性是任何协议，以保持连接到服务和应用程序必须与客户的关键。 混合应用程序依赖于每个位置可能具有其自己的 SLA。 这些不同的 Sla 可能会影响你的混合应用程序的总体 SLA。

## <a name="resiliency"></a>复原

复原能力是混合应用程序和系统从故障中恢复并继续工作的能力。 复原能力的目标是在故障发生后将应用程序恢复到可完全正常运行的状态。 复原策略包括备份、 复制和灾难恢复的解决方案。

有关此支柱核心讨论，请参阅[*复原*](https://docs.microsoft.com/azure/architecture/guide/pillars#resiliency)软件质量的构成要素中。

### <a name="resiliency-checklist"></a>复原能力查检表

**发现灾难恢复依赖项。** 中有一个云的灾难恢复可能需要对其他云应用程序组件的更改。 如果从一个云的一个或多个组件进行故障转移到另一个位置，在相同云内或向另一个云，需要了解这些更改的依赖组件。 这还包括连接依存关系。 复原能力对于每个云需要经过全面测试应用程序恢复计划。

**建立恢复流。** 有效的恢复流设计已评估应用程序组件，它们可以适应缓冲区，重试，重试失败的数据传输，并且如有必要，故障回复到不同的服务或工作流。 您必须确定要使用何种备份机制，其还原过程涉及和何种频率进行测试。 您还应确定增量和完整备份的频率。

**测试部分恢复。** 应用程序的一部分的部分恢复可以提供给用户的信心，所有不是不可用。 部分还原不会产生任何副作用，如备份和还原与要正常关闭它进行备份之前的应用程序进行交互的服务，应确保此计划的一部分。

**确定灾难恢复 instigators 并分配职责。** 恢复计划应描述人员，以及哪些角色可以启动除了什么可以备份和还原的备份和恢复操作。

**将使用灾难恢复的自我修复阈值进行比较。** 确定应用程序的自我修复功能，用于自动恢复启动和应用程序的自助-修复被视为失败或成功所需的时间。 确定针对每个云的阈值。

**验证可恢复性功能的可用性。** 确定复原功能和每个位置的功能的可用性。 如果位置不提供所需的功能，请考虑将该位置集成到集中式服务，它提供复原功能。

**确定故障时间。** 确定应用程序作为一个整体应用程序组件以及因维护而的预期停机时间。

**故障排除过程的文档。** 定义资源和应用程序组件重新部署故障排除的过程。

## <a name="manageability"></a>可管理性

有关如何管理你的混合应用程序的注意事项在设计您的体系结构中至关重要。 管理完善的混合应用程序提供了基础结构实现的常见开发管道中的一致的应用程序代码集成的代码。 通过实现一致系统级和各个测试的基础结构，更改就可以确保的集成的部署所做的更改通过的测试，如果允许这些要合并到的源代码。

有关此支柱核心讨论，请参阅[*管理和 DevOps* ](https://docs.microsoft.com/azure/architecture/guide/pillars#management-and-devops)软件质量的构成要素中。

### <a name="manageability-checklist"></a>可管理性清单

**实施监视。** 使用跨云应用程序组件分布的集中式监视系统提供其运行状况和性能的聚合的视图。 此系统包括监视应用程序组件和相关的平台功能。

确定需要监视的应用程序的部分。

**协调策略。** 混合应用程序跨越的每个位置可以有自己的策略，介绍了允许的资源类型，命名约定、 标记和其他条件。

**定义和使用角色。** 作为数据库管理员，您需要确定需要访问应用程序资源的不同角色 （如应用程序所有者、 数据库管理员和最终用户） 所需的权限。 需要的资源以及对应用程序中配置这些权限。 基于角色的访问控制 (RBAC) 系统，可在应用程序资源上设置这些权限。 这些访问权限时的所有资源部署在单个云，但需要更多关注时资源分布在云具有挑战性。 设置其他云资源不适用于在一个云中设置的资源的权限。

**使用 CI/CD 管道。** 持续集成和持续开发 (CI/CD) 管道可以提供创作和部署跨跨云，并为其基础结构和应用程序提供质量保证应用程序一致的流程。 此管道使基础结构和应用程序在一个云上进行测试和部署在另一个云上。 管道甚至允许您将为一个云混合应用程序的某些组件和其他组件部署到另一个云，实质上构成的混合应用程序部署的基础。 CI/CD 系统是关键依赖关系应用程序组件在安装期间，如 web 应用程序无数据库的连接字符串已适用于每个其他处理。

**管理生命周期。** 因为混合应用程序的资源可以跨位置，所以每个单个位置的生命周期管理功能需要聚合到单个的生命周期管理单元。 请考虑如何它们创建、 更新和删除。

**检查故障排除策略。** 故障排除的混合应用程序涉及到在单个云中运行的相同应用程序的多个应用程序组件。 除了云之间的连接，而不是一个两个平台上运行应用程序。 在混合应用程序故障排除的一项重要任务是检查聚合运行状况和性能监视的应用程序组件。

## <a name="security"></a>安全性

安全是关于任何云应用程序，主要考虑因素之一，它变得更加重要的混合云应用程序。

有关此支柱核心讨论，请参阅[*安全*](https://docs.microsoft.com/azure/architecture/guide/pillars#security)软件质量的构成要素中。

### <a name="security-checklist"></a>安全清单

**假设性违规。** 如果应用程序的一部分被泄露，请确保以最大程度减少安全违规，不仅在同一位置中，还在位置之间的传播有解决方案。

**允许网络访问权限的监视器。** 确定应用程序，如仅来自特定子网访问应用程序的网络访问策略，仅允许的最小端口和协议之间的应用程序才能正常工作所需的组件。

**使用强大的身份验证。** 可靠的身份验证方案对于你的应用程序的安全性至关重要。 请考虑使用的联合身份标识提供程序提供单一登录功能，并采用一个或多个以下方案： 用户名和密码登录、 公钥和私钥、 双因素或多重身份验证，以及受信任的安全组。 确定适当的资源来存储敏感数据和其他机密信息，以便除了证书类型和其要求的应用程序身份验证。

**使用加密。** 标识应用程序的哪些区域将加密，如用于数据存储或客户端通信和访问。

**使用安全通道。** 跨云的安全通道提供跨云的安全和身份验证检查、 实时保护、 隔离和其他服务至关重要。

**定义和使用角色。** 实现跨云资源配置和单身份标识访问角色。 确定应用程序和其平台资源的基于角色的访问控制 (RBAC) 要求。

**审核您的系统。** 系统监视可以记录并从应用程序组件和相关的云平台操作聚合数据。

## <a name="summary"></a>总结

本文提供了非常重要的创作和混合应用程序的设计过程中考虑的事项的清单。 部署应用程序之前查看这些支柱可防止遇到生产中断在这些问题和可能无需重新访问您的设计。

它可以事先起来耗时的任务，但如果您设计基于这些支柱应用程序轻松地获得投资回报率。

## <a name="next-steps"></a>后续步骤

有关详细信息，请参阅以下资源：

-   [混合云](https://azure.microsoft.com/overview/hybrid-cloud/)
-   [混合云应用程序](https://azure.microsoft.com/solutions/hybrid-cloud-app/)
-   [开发用于实现云一致性的 Azure 资源管理器模板](http://aka.ms/consistency)