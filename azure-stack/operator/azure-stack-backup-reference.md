---
title: 基础结构备份服务引用 |Microsoft Docs
description: Azure Stack 中心中的基础结构备份服务的参考资料。
services: azure-stack
documentationcenter: ''
author: justinha
manager: femila
editor: ''
ms.assetid: D6EC0224-97EA-446C-BC95-A3D32F668E2C
ms.service: azure-stack
ms.workload: na
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 02/12/2019
ms.author: justinha
ms.reviewer: hectorl
ms.lastreviewed: 10/25/2018
ms.openlocfilehash: 8e54ae96cec4fff9a50c541bab4ea8e60323ca22
ms.sourcegitcommit: d450dcf5ab9e2b22b8145319dca7098065af563b
ms.translationtype: MT
ms.contentlocale: zh-CN
ms.lasthandoff: 01/11/2020
ms.locfileid: "75882923"
---
# <a name="infrastructure-backup-service-reference"></a>基础结构备份服务引用

## <a name="azure-backup-infrastructure"></a>Azure 备份基础结构

Azure Stack 中心包含许多服务，其中包括门户（Azure 资源管理器）和总体基础结构管理体验。 Azure Stack 中心的类似于应用的管理体验侧重于降低向解决方案的操作员公开的复杂性。

基础结构备份服务旨在内在化为基础结构服务备份和还原数据的复杂性，从而确保操作员能够专注于管理解决方案并维护用户的 SLA。

需要将备份数据导出到外部共享，以避免在同一系统上存储备份。 如果需要外部共享，管理员可以灵活地根据现有公司 BC/DR 策略确定数据的存储位置。

### <a name="infrastructure-backup-service-components"></a>基础结构备份服务组件

基础结构备份服务包含以下组件：

 - **基础结构备份控制器**  
 基础结构备份控制器的实例化，并驻留在每个 Azure Stack 中心云中。
 - **备份资源提供程序**  
 备份资源提供程序（备份 RP）由用户界面和 Api 组成，它们公开了 Azure Stack 中心基础结构的基本备份功能。

#### <a name="infrastructure-backup-controller"></a>基础结构备份控制器

基础结构备份控制器是一个 Service Fabric 服务，可为 Azure Stack 中心云实例化。 备份资源在区域级别创建，从 AD、CA、Azure 资源管理器、CRP、SRP、NRP、Key Vault、RBAC 捕获特定于区域的服务数据。

### <a name="backup-resource-provider"></a>备份资源提供程序

备份资源提供程序在 Azure Stack 中心门户中显示一个用户界面，用于基本配置和列表备份资源。 操作员可以在用户界面中执行以下操作：

 - 通过提供外部存储位置、凭据和加密密钥首次启用备份。
 - 查看创建的已完成备份资源和状态资源。
 - 修改备份控制器放置备份数据的存储位置。
 - 修改备份控制器用来访问外部存储位置的凭据。
 - 修改备份控制器用来加密备份的加密密钥。


## <a name="backup-controller-requirements"></a>备份控制器要求

本部分介绍基础结构备份服务的重要要求。 建议你在为 Azure Stack 中心实例启用备份之前仔细查看此信息，然后在部署和后续操作过程中根据需要返回该信息。

要求包括：

  - **软件要求**-介绍支持的存储位置和大小调整指南。 
  - **网络要求**-描述不同存储位置的网络要求。  

### <a name="software-requirements"></a>软件要求

#### <a name="supported-storage-locations"></a>受支持的存储位置

| 存储位置                                                                 | 详细信息                                                                                                                                                  |
|----------------------------------------------------------------------------------|----------------------------------------------------------------------------------------------------------------------------------------------------------|
| 托管在受信任的网络环境中的存储设备上的 SMB 文件共享。 | 与 Azure Stack 中心部署在同一数据中心或不同数据中心的 SMB 共享。 多个 Azure Stack 集线器实例可以使用相同的文件共享。 |
| Azure 上的 SMB 文件共享。                                                          | 当前不支持。                                                                                                                                 |
| Azure 上的 Blob 存储。                                                            | 当前不支持。                                                                                                                                 |

#### <a name="supported-smb-versions"></a>支持的 SMB 版本

| SMB | 版本 |
|-----|---------|
| SMB | 3.x     |

#### <a name="smb-encryption"></a>SMB 加密

**1907及更高版本**

基础结构备份服务支持将备份数据传输到在服务器端启用了 SMB 加密的外部存储位置。 如果服务器不支持 SMB 加密或未启用该功能，则基础结构备份服务将回退到未加密的数据传输。 放置在外部存储位置上的备份数据始终加密在静态上，不依赖于 SMB 加密。

#### <a name="storage-location-sizing"></a>存储位置大小调整

建议一天备份一次，最多保留7天的备份。 这是在 Azure Stack 集线器上启用基础结构备份时的默认行为。

**1907及更高版本**

***系统已连接到 Azure AD 标识提供程序***

| 环境规模 | 预计的备份大小 | 所需的空间总量 |
|-------------------|--------------------------|--------------------------------|
| 4-16 节点/ASDK   | 1 GB                     | 20 GB                          |

***通过 ADFS 连接到公司 AD 标识提供者的系统***

| 环境规模 | 预计的备份大小 | 所需的空间总量 |
|-------------------|--------------------------|--------------------------------|
| 4-16 节点        | 20 GB                    | 280 GB                        |
| ASDK              | 10 GB                    | 140 GB                        |

**1907之前**

| 环境规模 | 预计的备份大小 | 所需的空间总量 |
|-------------------|--------------------------|--------------------------------|
| 4-16 节点        | 20 GB                    | 280 GB                        |
| ASDK              | 10 GB                    | 140 GB                        |

### <a name="network-requirements"></a>网络要求

| 存储位置                                                                 | 详细信息                                                                                                                                                                                 |
|----------------------------------------------------------------------------------|-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| 托管在受信任的网络环境中的存储设备上的 SMB 文件共享。 | 如果 Azure Stack 集线器实例驻留在防火墙处理环境中，则必须使用端口445。 基础结构备份控制器将通过端口445启动到 SMB 文件服务器的连接。 |
| 若要使用文件服务器的 FQDN，该名称必须可从 PEP 解析。             |                                                                                                                                                                                         |

> [!Note]  
> 无需打开任何入站端口。

### <a name="encryption-requirements"></a>加密要求

从1901开始，基础结构备份服务将使用带有公钥的证书（。CER）加密备份数据，并使用私钥（。PFX）在云恢复过程中对备份数据进行解密。

 - 证书用于传输密钥，而不用于建立经过安全验证的通信。 出于此原因，证书可以是自签名证书。 Azure Stack 中心无需验证此证书的根或信任，因此不需要外部 internet 访问。

自签名证书分为两部分，一个包含公钥，另一个具有私钥：

 - 加密备份数据：包含公钥的证书（已导出到）。CER 文件）用于加密备份数据。
 - "解密备份数据"：具有私钥的证书（已导出到）。PFX 文件）用于解密备份数据。

具有公钥的证书（。CER）不受内部机密旋转的管理。 若要轮替证书，需要创建新的自签名证书，并使用新文件（。CER）。 
 
 - 所有现有备份都将使用以前的公钥进行加密。 新备份使用新的公钥。
 
云恢复过程中使用私钥的证书（。由于安全原因，Azure Stack 集线器不会保留 PFX。 需要在云恢复过程中显式提供此文件。  

**向后兼容模式**从1901开始，已弃用加密密钥支持，并将在将来的版本中删除。 如果已从1811更新，并且已使用加密密钥启用了备份，Azure Stack 集线器将继续使用加密密钥。 至少三个版本支持向后兼容模式。 在此之后，将需要一个证书。

 * 从加密密钥更新到证书是一种单向操作。  
 * 所有现有备份都将使用加密密钥进行加密。 新的备份将使用证书。 

## <a name="infrastructure-backup-limits"></a>基础结构备份限制

在规划、部署和操作 Microsoft Azure Stack 中心实例时，请考虑这些限制。 下表描述了这些限制。

### <a name="infrastructure-backup-limits"></a>基础结构备份限制

| 限制标识符                                                 | 限制        | 注释                                                                                                                                    |
|------------------------------------------------------------------|--------------|---------------------------------------------------------------------------------------------------------------------------------------------|
| 备份类型                                                      | 仅满    | 基础结构备份控制器仅支持完整备份。 不支持增量备份。                                          |
| 计划的备份                                                | 计划和手动  | 备份控制器支持计划备份和按需备份。                                                                                 |
| 最大并发备份作业数                                   | 第            | 每个备份控制器实例仅支持一个活动备份作业。                                                                  |
| 网络交换机配置                                     | 不在范围内 | 管理员必须使用 OEM 工具备份网络交换机配置。 请参阅每个 OEM 供应商提供的 Azure Stack 集线器的文档。 |
| 硬件生命周期主机                                          | 不在范围内 | 管理员必须使用 OEM 工具备份硬件生命周期主机。 请参阅每个 OEM 供应商提供的 Azure Stack 集线器的文档。      |
| 文件共享的最大数目                                    | 第            | 只能使用一个文件共享来存储备份数据。                                                                                        |
| 备份应用服务、函数、SQL、mysql 资源提供程序数据 | 不在范围内 | 请参阅已发布的用于部署和管理由 Microsoft 创建的增值 Rp 的指南。                                                  |
| 备份第三方资源提供程序                              | 不在范围内 | 请参阅已发布的用于部署和管理由第三方供应商创建的增值 Rp 的指南。                                          |

## <a name="next-steps"></a>后续步骤

 - 若要了解有关基础结构备份服务的详细信息，请参阅[具有基础结构备份服务的 Azure Stack 中心的备份和数据恢复](azure-stack-backup-infrastructure-backup.md)。
