---
title: 在 Azure Stack 集线器中从灾难性数据丢失中恢复
description: 了解如何在发生灾难性数据丢失后恢复和恢复 Azure Stack 中心的基础结构数据。
author: justinha
ms.topic: article
ms.date: 02/12/2019
ms.author: justinha
ms.reviewer: hectorl
ms.lastreviewed: 11/05/2019
ms.openlocfilehash: 00eba2158fcb4e5a2e18f88d0493e1bb2e7c3b3d
ms.sourcegitcommit: 4ac711ec37c6653c71b126d09c1f93ec4215a489
ms.translationtype: MT
ms.contentlocale: zh-CN
ms.lasthandoff: 02/27/2020
ms.locfileid: "77703581"
---
# <a name="recover-from-catastrophic-data-loss"></a>在发生灾难性数据丢失后进行恢复

Azure Stack 中心在你的数据中心内运行 Azure 服务，并可在小型到单个机架中安装了四个节点的环境上运行。 与此相反，Azure 在多个数据中心的多个区域和每个区域的多个区域中40运行。 用户资源可以跨多个服务器、机架、数据中心和区域。 利用 Azure Stack Hub，当前只能选择将整个云部署到单个机架中。 此限制使你的云面临你的数据中心发生灾难性事件的风险，或因主要产品错误而失败。 发生灾难时，Azure Stack 中心实例处于脱机状态。 所有数据都可能无法恢复。

根据数据丢失的根本原因，可能需要修复单个基础结构服务或还原整个 Azure Stack 中心实例。 甚至可能需要还原到相同位置或不同位置中的不同硬件。

此方案用于在出现故障和重新部署私有云时恢复整个安装。

| 场景                                                           | 数据丢失                            | 注意事项                                                             |
|--------------------------------------------------------------------|--------------------------------------|----------------------------------------------------------------------------|
| 由于灾难或产品 bug，从灾难性数据丢失中恢复。 | 所有基础结构、用户和应用程序数据。 | 用户应用和数据独立于基础结构数据进行保护。 |

## <a name="workflows"></a>工作流

保护 Azure 入门的旅程开始，单独备份基础结构和应用/租户数据。 本文档介绍了如何保护基础结构。 

![Azure Stack 中心数据恢复工作流—部署](media/azure-stack-backup/azure-stack-backup-workflow1.png)

在所有数据丢失的最坏情况下，恢复 Azure Stack 中心是还原 Azure Stack 中心和所有用户数据的部署所独有的基础结构数据的过程。 

![Azure Stack 中心数据恢复工作流-重新部署](media/azure-stack-backup/azure-stack-backup-workflow2.png)

## <a name="restore"></a>还原

如果发生灾难性数据丢失但硬件仍可用，则需要重新部署 Azure Stack 集线器。 重新部署过程中，可以指定访问备份所需的存储位置和凭据。 在此模式下，无需指定需要恢复的服务。 基础结构备份控制器将控制平面状态作为部署工作流的一部分插入。

如果出现导致硬件不可用的灾难，则只能在新硬件上重新部署。 重新部署可能需要花费几周的时间，同时对硬件进行排序并进入数据中心。 随时可以还原控制面数据。 但是，如果重新部署的实例的版本超过了在上次备份中使用的版本，则不支持 restore。

| 部署模式 | 起点 | 终结点                                                                                                                                                                                                     |
|-----------------|----------------|---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| 全新安装   | 基线生成 | OEM 将 Azure Stack 中心和更新部署到最新的受支持版本。                                                                                                                                          |
| 恢复模式   | 基线生成 | OEM 在恢复模式下部署 Azure Stack 集线器，并根据可用的最新备份来处理版本匹配要求。 OEM 通过更新到支持的最新版本来完成部署。 |

## <a name="data-in-backups"></a>备份中的数据

Azure Stack 中心支持一种称为云恢复模式的部署。 仅当你选择在灾难或产品 bug 使解决方案无法恢复后恢复 Azure Stack 中心时，才使用此模式。 此部署模式不会恢复解决方案中存储的任何用户数据。 此部署模式的作用域仅限于还原以下数据：

 - 部署输入
 - 内部标识服务数据（ADFS 部署）。
 - 联合识别配置（ADFS 部署）。
 - 内部证书颁发机构使用的根证书。
 - Azure 资源管理器配置用户数据，如订阅、计划、产品/服务、存储配额、网络配额和计算资源。
 - Key Vault 的机密和保管库。
 - RBAC 策略分配和角色分配。

在部署过程中，不会恢复任何用户基础结构即服务（IaaS）或平台即服务（PaaS）资源。 这些损失包括 IaaS Vm、存储帐户、blob、表、网络配置等。 云恢复的目的是确保操作员和用户可以在部署完成后重新登录到门户。 重新登录的用户不会看到其任何资源。 用户会还原他们的订阅，以及管理员定义的原始计划、产品/服务和策略。重新登录到系统的用户在灾难发生之前由原始解决方案施加的相同约束运行。 云恢复完成后，操作员可以手动还原增值和第三方 RPs 及关联的数据。

## <a name="next-steps"></a>后续步骤

了解[使用基础结构备份服务](azure-stack-backup-best-practices.md)的最佳实践。
